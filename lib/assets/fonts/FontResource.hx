package assets.fonts;

import js.html.FontFaceDescriptors;
import js.lib.Error;
import assets.fonts.providers.CSSProvider;
import assets.fonts.providers.FontFaceProvider;
import assets.fonts.providers.FontsUtils;
import assets.fonts.providers.IProvider;

/**
 * –®—Ä–∏—Ñ—Ç.  
 * –û–±—ä–µ–∫—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ —Ñ–∞–π–ª–∞ —à—Ä–∏—Ñ—Ç–∞
 * –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –µ–≥–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, canvas –∏–ª–∏ –≤ CSS —Å—Ç–∏–ª—è—Ö.
 * 
 * –≠—Ç–æ—Ç –∑–∞–≥—Ä—É–∑—á–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö —Å–ø–æ—Å–æ–±–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤
 * –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–Ω—Ç–∞–π–º–∞ –∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ
 * —Å–º.: `assets.fonts.providers.IProvider`
 */
class FontResource extends Resource<FontResource, FontParams>
{
    /**
     * –ü–æ–¥–¥–µ—Ä–∂–∫–∞ [FontFace API](https://developer.mozilla.org/en-US/docs/Web/API/FontFace/FontFace).
     */
    static private var isFontFaceSupported:Bool = null;
    static private var providerAPI:IProvider = new FontFaceProvider();
    static private var providerCSS:IProvider = new CSSProvider();

    /**
     * –°–æ–∑–¥–∞—Ç—å —Ä–µ—Å—É—Ä—Å –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —à—Ä–∏—Ñ—Ç–∞.
     * @param manager –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≥—Ä—É–∑—á–∏–∫–∞.
     * @param params –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞.
     */
    private function new(manager:FontsManager, params:FontParams) {
        super(manager, params.id==null?Std.string(params.source):params.id, ResourceType.FONT, params);

        this.family = params.family;
        this.source = params.source;
        this.descriptors = params.descriptors==null?null:params.descriptors;
        this.legacy = !!params.legacy;
        this.testString = (params.testString == null || params.testString == "")?"0123456789":params.testString;
        this.timeout = params.timeout == null?10000:params.timeout;

        if (isFontFaceSupported == null)
            isFontFaceSupported = FontsUtils.isSupportedFontFaceAPI();
    }

    /**
     * –°–ø–æ—Å–æ–± –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —à—Ä–∏—Ñ—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É.  
     * –ú–æ–∂–µ—Ç –±—ã—Ç—å `null`
     */
    private var provider(default, null):IProvider = null;

    /**
     * –°–µ–º–µ–π—Å—Ç–≤–æ —à—Ä–∏—Ñ—Ç–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–µ–µ—Å—è –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.  
     * –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–∞ `@font-face/font-family` –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—É.
     * 
     * –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
     */
    public var family(default, null):String;

    /**
     * URL –ê–¥—Ä–µ—Å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏.  
     * –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
     * - `String` - URL –ê–¥—Ä–µ—Å —Å —à—Ä–∏—Ñ—Ç–æ–º.
     * - `Array[String]` - –ú–∞—Å—Å–∏–≤ —Å URL –∞–¥—Ä–µ—Å–∞–º–∏ —à—Ä–∏—Ñ—Ç–∞.
     */
    public var source(default, null):Dynamic;

    /**
     * –ù–∞–±–æ—Ä –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è —à—Ä–∏—Ñ—Ç–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö
     * –ø—Ä–∏ –µ–≥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.
     */
    public var descriptors(default, null):FontFaceDescriptors;

    /**
     * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —à—Ä–∏—Ñ—Ç–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ CSS.
     * 
     * –ï—Å–ª–∏ `true`, –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω 
     * —Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±, –¥–∞–∂–µ –µ—Å–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –µ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∞ FontFace API.
     * –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏–ª–∏ –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
     * 
     * –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false` *(–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å FontFace API, –µ—Å–ª–∏ –µ—Å—Ç—å)*
     */
    public var legacy(default, null):Bool;

    /**
     * –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∞–∫—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à—Ä–∏—Ñ—Ç–∞.
     * 
     * –≠—Ç–æ –Ω–∞–±–æ—Ä —Å–∏–º–≤–æ–ª–æ–≤, –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è —Ñ–∞–∫—Ç
     * –∑–∞–≥—Ä—É–∑–∫–∏ —à—Ä–∏—Ñ—Ç–∞. –≠—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ CSS
     * –∑–∞–≥—Ä—É–∑–∫–µ —à—Ä–∏—Ñ—Ç–æ–≤, –∫–æ–≥–¥–∞ **FontFace** API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏–ª–∏ —è–≤–Ω–æ
     * –∑–∞–¥–∞–Ω —Ñ–ª–∞–≥ `legacy`.
     * 
     * **–í–∞–∂–Ω–æ:** –≠—Ç–∏ —Å–∏–º–≤–æ–ª—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–º —à—Ä–∏—Ñ—Ç–µ!
     * –ò–Ω–∞—á–µ —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É. üëÄ
     * 
     * –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `0123456789` *(–ù–∞–±–æ—Ä —á–∏—Å–µ–ª, –∫–∞–∫ —Å–∞–º—ã–π –≤–µ—Ä–æ—è—Ç–Ω—ã–π –ø–µ—Ä–µ—á–µ–Ω—å —Å–∏–º–≤–æ–ª–æ–≤ –≤ –ª—é–±–æ–º —à—Ä–∏—Ñ—Ç–µ)*
     */
    public var testString(default, null):String;

    /**
     * –¢–∞–π–º—É—Ç –¥–ª—è –∑–∞–≥—É–∑–∫–∏ —à—Ä–∏—Ñ—Ç–∞. (mc)
     * 
     * –≠—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ CSS –∑–∞–≥—Ä—É–∑–∫–µ. (`legacy=true`)
     * –¢–∞–∫ –∫–∞–∫ –∑–∞–≥—Ä—É–∑–∫–∞ —Å –ø–æ–º–æ—â—å—é CSS –Ω–µ –∏–¥–µ–∞–ª—å–Ω–∞ –∏ —Ç–µ–æ—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–æ–∂–µ—Ç
     * –∑–∞–≤–∏—Å–Ω—É—Ç—å, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–∞–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ. –í —Å–ª—É—á–∞–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏,
     * –∑–∞–≥—Ä—É–∑–∫–∞ —à—Ä–∏—Ñ—Ç–∞ –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–æ–π —Ç–∞–π–º–∞—É—Ç–∞.
     * 
     * –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `10000` *(10 –°–µ–∫—É–Ω–¥)*
     */
    public var timeout(default, null):Int;

    /**
     * –ù–∞—á–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —à—Ä–∏—Ñ—Ç–∞.  
     */
    override private function load():Void {
        if (isLoading || isComplete || isDisposed)
            return;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
        isLoading = true;
        provider = (legacy || !isFontFaceSupported) ? providerCSS : providerAPI;
        provider.add(this, onLoaded);
    }

    private function onLoaded(res:FontResource, err:Error):Void {
        if (isDisposed)
            return;

        isLoading = false;
        isComplete = true;

        error = err;

        onComplete.emit(this);
    }

    /**
     * –£–Ω–∏—á—Ç–æ–∂–∏—Ç—å —ç—Ç–æ—Ç —à—Ä–∏—Ñ—Ç. üî•  
     * –í—ã–∑–æ–≤ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ —ç—Ç–æ—Ç —Ä–µ—Å—É—Ä—Å —É–∂–µ –±—ã–ª –≤—ã–≥—Ä—É–∂–µ–Ω.
     * - –í—ã–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–∏–º —Ä–µ—Å—É—Ä—Å–æ–º.
     * - –£–¥–∞–ª—è–µ—Ç —à—Ä–∏—Ñ—Ç —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
     * - –û—á–∏—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ª—É—à–∞—Ç–µ–ª–µ–π `onComplete=null`.
     * - –£–¥–∞–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ `manager=null`.
     * - –£–¥–∞–ª—è–µ—Ç –æ—à–∏–±–∫—É `error=null`.
     * - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–≤–æ–π—Å—Ç–≤–æ `isDisposed=true`.
     * 
     * –í—ã –±–æ–ª—å—à–µ –Ω–µ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç!
     */
    override public function dispose():Void {
        if (isDisposed)
            return;

        if (provider != null) {
            provider.remove(this);
            provider = null;
        }

        super.dispose();
    }

    /**
     * –ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç—Ç–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞.
     * @return –°—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞.
     */
    @:keep
    @:noCompletion
    override public function toString():String {
        return "[FontResource id=" + id + "]";
    }
}

/**
 * –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞.
 */
typedef FontParams =
{
    /**
     * ID –†–µ—Å—É—Ä—Å–∞.  
     * –ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ **source**.
     */
    @:optional var id:String;

    /**
     * –°–µ–º–µ–π—Å—Ç–≤–æ —à—Ä–∏—Ñ—Ç–æ–≤.  
     * –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—é `@font-face/font-family` CSS —Å—Ç–∏–ª–µ–π.
     * 
     * –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
     */
    var family:String;

    /**
     * URL –ê–¥—Ä–µ—Å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏.  
     * –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
     * - `String` - URL –ê–¥—Ä–µ—Å —Å —à—Ä–∏—Ñ—Ç–æ–º.
     * - `Array[String]` - –ú–∞—Å—Å–∏–≤ —Å URL –∞–¥—Ä–µ—Å–∞–º–∏ —à—Ä–∏—Ñ—Ç–∞.
     */
    var source:Dynamic;

    /**
     * –ù–∞–±–æ—Ä –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è —à—Ä–∏—Ñ—Ç–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö
     * –ø—Ä–∏ –µ–≥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.
     */
    @:optional var descriptors:FontFaceDescriptors;

    /**
     * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —à—Ä–∏—Ñ—Ç–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ CSS.
     * 
     * –ï—Å–ª–∏ `true`, –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω 
     * —Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±, –¥–∞–∂–µ –µ—Å–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –µ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∞ FontFace API.
     * –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏–ª–∏ –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
     * 
     * –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false` *(–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å FontFace API, –µ—Å–ª–∏ –µ—Å—Ç—å)*
     * 
     * @see –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —à—Ä–∏—Ñ—Ç–æ–≤: `assets.fonts.providers.IProvider`
     */
    @:optional var legacy:Bool;

    /**
     * –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∞–∫—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à—Ä–∏—Ñ—Ç–∞.
     * 
     * –≠—Ç–æ –Ω–∞–±–æ—Ä —Å–∏–º–≤–æ–ª–æ–≤, –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è —Ñ–∞–∫—Ç
     * –∑–∞–≥—Ä—É–∑–∫–∏ —à—Ä–∏—Ñ—Ç–∞. –≠—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ CSS
     * –∑–∞–≥—Ä—É–∑–∫–µ —à—Ä–∏—Ñ—Ç–æ–≤, –∫–æ–≥–¥–∞ **FontFace** API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏–ª–∏ —è–≤–Ω–æ
     * –∑–∞–¥–∞–Ω —Ñ–ª–∞–≥ `legacy`.
     * 
     * **–í–∞–∂–Ω–æ:** –≠—Ç–∏ —Å–∏–º–≤–æ–ª—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–º —à—Ä–∏—Ñ—Ç–µ!
     * –ò–Ω–∞—á–µ —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É. üëÄ
     * 
     * –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `0123456789` *(–ù–∞–±–æ—Ä —á–∏—Å–µ–ª, –∫–∞–∫ —Å–∞–º—ã–π –≤–µ—Ä–æ—è—Ç–Ω—ã–π –ø–µ—Ä–µ—á–µ–Ω—å —Å–∏–º–≤–æ–ª–æ–≤ –≤ –ª—é–±–æ–º —à—Ä–∏—Ñ—Ç–µ)*
     */
    @:optional var testString:String;

    /**
     * –¢–∞–π–º—É—Ç –¥–ª—è –∑–∞–≥—É–∑–∫–∏ —à—Ä–∏—Ñ—Ç–∞. (mc)
     * 
     * –≠—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ CSS –∑–∞–≥—Ä—É–∑–∫–µ. (`legacy=true`)
     * –¢–∞–∫ –∫–∞–∫ –∑–∞–≥—Ä—É–∑–∫–∞ —Å –ø–æ–º–æ—â—å—é CSS –Ω–µ –∏–¥–µ–∞–ª—å–Ω–∞ –∏ —Ç–µ–æ—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–æ–∂–µ—Ç
     * –∑–∞–≤–∏—Å–Ω—É—Ç—å, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–∞–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ. –í —Å–ª—É—á–∞–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏,
     * –∑–∞–≥—Ä—É–∑–∫–∞ —à—Ä–∏—Ñ—Ç–∞ –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–æ–π —Ç–∞–π–º–∞—É—Ç–∞.
     * 
     * –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `10000` *(10 –°–µ–∫—É–Ω–¥)*
     */
    @:optional var timeout:Int;
}